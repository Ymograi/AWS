#tokenlist  = pd.read_pickle("NSE_FUT.pkl")
tokenlist  = pd.read_pickle("BANKNIFTY.pkl")
tokenlist = tokenlist[['instrument_token','tradingsymbol']]
tokenlist = tokenlist.reset_index(drop=True)
tokenlist

r14.flushdb()

print("Creating {} Tables in Redis.....".format(len(tokenlist)))
for i,j in tokenlist.iterrows():
    
    while True:
        try:
            historicdata = kite.historical_data(j.instrument_token, '2018-05-30', s.ToDate(), "minute", continuous=False) 
            r14.lpush(j.tradingsymbol,historicdata)      
            break
        
        except Exception as e:
            print("------>",e,"   ---->",j.tradingsymbol)

    
print(len( r14.keys())," Tables created in Redis DB-14")
